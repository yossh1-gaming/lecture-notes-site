<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>メール認証完了</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <div class="container">
    <h1>メール認証中…</h1>
    <p id="status">しばらくお待ちください。</p>
    <p><a href="index.html">ログイン画面へ戻る</a></p>
  </div>

  <!-- confirm.html の <body> 終わりに -->
  <script type="module">
    import { supabase } from "./js/supabase.js";

    // ハッシュからトークンを復元（email確認リンク用）
    const hash = new URL(location.href).hash;
    const params = new URLSearchParams(hash.slice(1));
    const access_token  = params.get("access_token");
    const refresh_token = params.get("refresh_token");

    async function run() {
      const out = document.getElementById("result");
      if (access_token && refresh_token) {
        const { error } = await supabase.auth.setSession({ access_token, refresh_token });
        if (error) {
          out.textContent = "認証の確立に失敗しました：" + error.message;
          return;
        }
        out.textContent = "メール認証が完了しました。";
        setTimeout(() => location.replace("main.html"), 1200);
      } else {
        out.textContent = "無効なリンクです。";
      }
    }
    run();
  </script>

</body>
</html>
